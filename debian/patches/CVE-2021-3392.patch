From: Markus Koschany <apo@debian.org>
Date: Fri, 10 Apr 2021 12:50:06 +0200
Subject: CVE-2021-3392

Bug-Debian: https://bugs.debian.org/984449
Origin: https://lists.gnu.org/archive/html/qemu-devel/2021-02/msg00488.html
---
 hw/scsi/mptsas.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/hw/scsi/mptsas.c b/hw/scsi/mptsas.c
index 421955b..e373f07 100644
--- a/hw/scsi/mptsas.c
+++ b/hw/scsi/mptsas.c
@@ -259,8 +259,8 @@ static void mptsas_free_request(MPTSASRequest *req)
         req->sreq->hba_private = NULL;
         scsi_req_unref(req->sreq);
         req->sreq = NULL;
-        QTAILQ_REMOVE(&s->pending, req, next);
     }
+    QTAILQ_REMOVE(&s->pending, req, next);
     qemu_sglist_destroy(&req->qsg);
     g_free(req);
 }
